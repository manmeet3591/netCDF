# -*- coding: utf-8 -*-
from scipy.interpolate import interp1d
import sys, string
from matplotlib import rc
import numpy as np
import pylab as pl
import netCDF4
import time as t
import datetime
from dateutil.parser import parse
from pylab import load, meshgrid, title, arange, show
from netcdftime import utime
import scipy.io
import matplotlib as mpl
import argparse
from matplotlib.dates import MonthLocator, WeekdayLocator, DateFormatter
import datetime as dt


plot = False
check = False

while check == False:
	input = raw_input(('Plot? y/n: '))
	if input == 'y':
		check = True
		plot = True
	if input == 'n':
		check = True
# Init
t_cya_field =np.array([])
t_lpp_field =np.array([])
t_spp_field =np.array([])
t_nh4_field =np.array([])
t_no3_field =np.array([])
t_po4_field =np.array([])
t_zoo_field =np.array([])
t_ipw_field =np.array([])
t_det_field =np.array([])
t_don_field =np.array([])
t_sed_1_field =np.array([])
t_ips_1_field =np.array([])
temp_field =np.array([])
temp_field_std = np.array([])
salt_field =np.array([])
salt_field_std=np.array([])
salt_list_2 = []
temp_list_2 = []
salt_list_200 = []
temp_list_200 = []
o2_list_200 = []

for i in range (1850, 2009):
	year = str(i)
	nc_data = netCDF4.Dataset('/silos/boergel/BREC/files/auswertung' + year + '.nc')
	variable_list = []
	for i in nc_data.variables:
	    variable_list.append(nc_data.variables[str(i)])
	t_cya_field =np.append(t_cya_field , np.mean(variable_list[16][:]))
	t_lpp_field =np.append(t_lpp_field , np.mean(variable_list[17][:]))
	t_spp_field =np.append(t_spp_field , np.mean(variable_list[18][:]))
	t_nh4_field =np.append(t_nh4_field , np.mean(variable_list[19][:]))
	t_no3_field =np.append(t_no3_field , np.mean(variable_list[20][:]))
	t_po4_field =np.append(t_po4_field , np.mean(variable_list[21][:]))
	t_zoo_field =np.append(t_zoo_field , np.mean(variable_list[22][:]))
	t_ipw_field =np.append(t_ipw_field , np.mean(variable_list[23][:]))
	t_det_field =np.append(t_det_field , np.mean(variable_list[24][:]))
	t_don_field =np.append(t_don_field , np.mean(variable_list[25][:]))
	t_sed_1_field =np.append(t_sed_1_field , np.mean(variable_list[26][:]))
	t_ips_1_field =np.append(t_ips_1_field , np.mean(variable_list[27][:]))
	temp_field =np.append(temp_field , np.mean(variable_list[28][:]))
	temp_field_std = np.append(temp_field_std, np.std(variable_list[28][:]))
	salt_field =np.append(salt_field , np.mean(variable_list[29][:]))
        salt_field_std = np.append(salt_field_std, np.std(variable_list[29][:]))

	# Markus Validation
	nc_raw = netCDF4.Dataset('/silos/thomas/ModelExp/BREC/V01_R02/balt-3nm-skag-v01-r02_' + year + '/ocean_day3d.nc')
        temp_2 = nc_raw.variables['temp'][:,1,69,118]
        salt_2 = nc_raw.variables['salt'][:,1,69,118]
	o2_200    = nc_raw.variables['t_o2'][:,100,69,118]*22.4*1000
        temp = np.mean(temp_2, axis = 0)
        salt = np.mean(salt_2, axis = 0)
	o2_200 = np.mean(o2_200, axis = 0)
        salt_list_2.append(salt)
        temp_list_2.append(temp)
        temp_200 = nc_raw.variables['temp'][:,100,69,118]
        salt_200 = nc_raw.variables['salt'][:,100,69,118]
        temp_200 = np.mean(temp_200, axis = 0)
        salt_200 = np.mean(salt_200, axis = 0)
        salt_list_200.append(salt_200)
        temp_list_200.append(temp_200)
	o2_list_200.append(o2_200)
        print 'Done with' + year


## Calculate 10 year mean
t_cya_field_10y =np.ones([len(t_cya_field)/10+1])
t_lpp_field_10y =np.ones([len(t_cya_field)/10+1])
t_spp_field_10y =np.ones([len(t_cya_field)/10+1])
t_nh4_field_10y =np.ones([len(t_cya_field)/10+1])
t_no3_field_10y =np.ones([len(t_cya_field)/10+1])
t_po4_field_10y =np.ones([len(t_cya_field)/10+1])
t_zoo_field_10y =np.ones([len(t_cya_field)/10+1])
t_ipw_field_10y =np.ones([len(t_cya_field)/10+1])
t_det_field_10y =np.ones([len(t_cya_field)/10+1])
t_don_field_10y =np.ones([len(t_cya_field)/10+1])
t_sed_1_field_10y =np.ones([len(t_cya_field)/10+1])
t_ips_1_field_10y =np.ones([len(t_cya_field)/10+1])
temp_field_10y =np.ones([len(t_cya_field)/10+1])
salt_field_10y =np.ones([len(t_cya_field)/10+1])

for i in range(len(t_cya_field)/10+1):
    	t_cya_field_10y[i] = np.mean(t_cya_field[0+i*10:9+i*10])
	t_lpp_field_10y[i] = np.mean(t_lpp_field[0+i*10:9+i*10])
	t_spp_field_10y[i] = np.mean(t_spp_field[0+i*10:9+i*10])
	t_nh4_field_10y[i] = np.mean(t_nh4_field[0+i*10:9+i*10])
	t_no3_field_10y[i] = np.mean(t_no3_field[0+i*10:9+i*10])
	t_po4_field_10y[i] = np.mean(t_po4_field[0+i*10:9+i*10])
	t_zoo_field_10y[i] = np.mean(t_zoo_field[0+i*10:9+i*10])
	t_ipw_field_10y[i] = np.mean(t_ipw_field[0+i*10:9+i*10])
	t_det_field_10y[i] = np.mean(t_det_field[0+i*10:9+i*10])
	t_don_field_10y[i] = np.mean(t_don_field[0+i*10:9+i*10])
	t_sed_1_field_10y[i] = np.mean(t_sed_1_field[0+i*10:9+i*10])
	t_ips_1_field_10y[i] = np.mean(t_ips_1_field[0+i*10:9+i*10])
	temp_field_10y[i] = np.mean(temp_field[0+i*10:9+i*10])
	salt_field_10y[i] = np.mean(salt_field[0+i*10:9+i*10])

## Calculate Running mean
t_cya_field_run =np.array([])
t_lpp_field_run =np.array([])
t_spp_field_run =np.array([])
t_nh4_field_run =np.array([])
t_no3_field_run =np.array([])
t_po4_field_run =np.array([])
t_zoo_field_run =np.array([])
t_ipw_field_run =np.array([])
t_det_field_run =np.array([])
t_don_field_run =np.array([])
t_sed_1_field_run =np.array([])
t_ips_1_field_run =np.array([])
temp_field_run =np.array([])
salt_field_run =np.array([])

for i in range(len(t_cya_field)-1):
	t_cya_field_run = np.append(t_cya_field_run, np.mean(t_cya_field[i:i+5]))
	t_lpp_field_run = np.append(t_lpp_field_run, np.mean(t_lpp_field[i:i+5]))
	t_spp_field_run = np.append(t_spp_field_run, np.mean(t_spp_field[i:i+5]))
	t_nh4_field_run = np.append(t_nh4_field_run, np.mean(t_nh4_field[i:i+5]))
	t_no3_field_run = np.append(t_no3_field_run, np.mean(t_no3_field[i:i+5]))
	t_po4_field_run = np.append(t_po4_field_run, np.mean(t_po4_field[i:i+5]))
	t_zoo_field_run = np.append(t_zoo_field_run, np.mean(t_zoo_field[i:i+5]))
	t_ipw_field_run = np.append(t_ipw_field_run, np.mean(t_ipw_field[i:i+5]))
	t_det_field_run = np.append(t_det_field_run, np.mean(t_det_field[i:i+5]))
	t_don_field_run = np.append(t_don_field_run, np.mean(t_don_field[i:i+5]))
	t_sed_1_field_run = np.append(t_sed_1_field_run, np.mean(t_sed_1_field[i:i+5]))
	t_ips_1_field_run = np.append(t_ips_1_field_run, np.mean(t_ips_1_field[i:i+5]))
	temp_field_run = np.append(temp_field_run, np.mean(temp_field[i:i+5]))
	salt_field_run = np.append(salt_field_run, np.mean(salt_field[i:i+5]))

# Fit Functions
x = np.arange((len(temp_field)))
x = x+1850
#temp_mean = np.mean(temp_field)
#temp_std = np.std(temp_field)
fit_t_2 = np.polyfit(x,temp_list_2,1)
fit_fn_t_2 = np.poly1d(fit_t_2)
fit_t_200 = np.polyfit(x,temp_list_200,1)
fit_fn_t_200 = np.poly1d(fit_t_200)
fit_s_2 = np.polyfit(x,salt_list_2,1)
fit_fn_s_2 = np.poly1d(fit_s_2)
fit_s_200 = np.polyfit(x,salt_list_2,1)
fit_fn_s_200 = np.poly1d(fit_s_200)

#pl.figure()
#pl.plot(x, temp_field, '-b', x, fit_fn(x), '--k')
#pl.axhline(y=temp_mean, xmin=0, xmax=1, hold=None, color='red')
#pl.axhline(y=temp_mean+temp_std, xmin=0, xmax=1, hold=None, color='green')
#pl.axhline(y=temp_mean-temp_std, xmin=0, xmax=1, hold=None, color='green')

a = 1

if plot == True:
	a = pl.figure()
	ax1 = pl.subplot(711)
	pl.plot(x, temp_list_2)
	pl.plot(x,fit_fn_t_2(x), '--r')
	pl.setp(ax1.get_xticklabels(), fontsize=6)
	pl.setp(ax1.get_yticklabels(), fontsize=6)
	pl.ylabel('T in [C] at 2m',fontsize=6)

        ax2 = pl.subplot(712, sharex=ax1)
        pl.plot(x, temp_list_200)
        pl.plot(x,fit_fn_t_200(x), '--r')
        pl.setp(ax2.get_xticklabels(), fontsize=6)
        pl.setp(ax2.get_yticklabels(), fontsize=6)
        pl.ylabel('T in [C] at 200 m', fontsize = 6)

	# share x only
	ax3 = pl.subplot(713, sharex=ax1)
	pl.plot(x, salt_list_2, '-r')
	pl.plot(x,fit_fn_s_2(x),'--r')
	# make these tick labels invisible
	pl.setp(ax3.get_xticklabels(), fontsize=6)
	pl.setp(ax3.get_yticklabels(), fontsize=6)
	pl.ylabel('Salt [psu] at 2 m', fontsize = 6)

	# share x only
        ax4 = pl.subplot(714, sharex=ax1)
        pl.plot(x, salt_list_200, '-r')
	pl.plot(x, fit_fn_s_200(x), '--r')
        # make these tick labels invisible
        pl.setp(ax4.get_xticklabels(), fontsize=6)
        pl.setp(ax4.get_yticklabels(), fontsize=6)
        pl.ylabel('Salt [psu] at 200 m', fontsize = 6)


	ax5 = pl.subplot(715, sharex=ax1)
	pl.setp(ax5.get_xticklabels(), fontsize=6)
	pl.setp(ax5.get_yticklabels(), fontsize=6)
	pl.plot(x, t_po4_field, '-g')
	pl.ylabel('po4 [mol]', fontsize = 6)

	ax6 = pl.subplot(716, sharex=ax1)
	pl.setp(ax6.get_xticklabels(), fontsize=6)
	pl.setp(ax6.get_yticklabels(), fontsize=6)
	pl.plot(x,t_no3_field, '-b')
	pl.ylabel('NO3 [mol]', fontsize = 6)

        ax7 = pl.subplot(717, sharex=ax1)
        pl.setp(ax7.get_xticklabels(), fontsize=6)
        pl.setp(ax7.get_yticklabels(), fontsize=6)
        pl.plot(x,o2_list_200, '-b')
        pl.ylabel('O2 [l/kg] at 200 m', fontsize = 6)
        a.subplots_adjust(hspace=0.2)

	a.savefig('../figures/mean/meier.png')

	# Plot Field
	pl.figure()
	pl.plot( x,t_cya_field )
	pl.xlabel('time')
	pl.title('t_cya_field')
	pl.savefig('../figures/mean/t_cya_field.png')
	pl.figure()
	pl.plot( x,t_lpp_field )
	pl.xlabel('time (s)')
	pl.title('t_lpp_field')
	pl.savefig('../figures/mean/t_lpp_field.png')
	pl.figure()
	pl.plot(x,t_spp_field)
	pl.xlabel('time (s)')
	pl.title('t_spp_field')
	pl.savefig('../figures/mean/t_spp_field.png')
	pl.figure()
	pl.plot(x,t_nh4_field)
	pl.xlabel('time (s)')
	pl.title('t_nh4_field')
	pl.savefig('../figures/mean/t_nh4_field.png')
	pl.figure()
	pl.plot(x,t_no3_field)
	pl.xlabel('time (s)')
	pl.title('t_no3_field')
	pl.savefig('../figures/mean/t_no3_field.png')
	pl.figure()
	pl.plot(x,t_po4_field)
	pl.xlabel('time (s)')
	pl.title('t_po4_field')
	pl.savefig('../figures/mean/t_po4_field.png')
	pl.figure()
	pl.plot(x,t_zoo_field)
	pl.xlabel('time (s)')
	pl.title('t_zoo_field')
	pl.savefig('../figures/mean/t_zoo_field.png')
	pl.figure()
	pl.plot(x,t_ipw_field)
	pl.xlabel('time (s)')
	pl.title('t_ipw_field')
	pl.savefig('../figures/mean/t_ipw_field.png')
	pl.figure()
	pl.plot(x,t_det_field)
	pl.xlabel('time (s)')
	pl.title('t_det_field')
	pl.savefig('../figures/mean/t_det_field.png')
	pl.figure()
	pl.plot(x, t_don_field )
	pl.xlabel('time (s)')
	pl.title('t_don_field')
	pl.savefig('../figures/mean/t_don_field.png')
	pl.figure()
	pl.plot(x, t_sed_1_field )
	pl.xlabel('time (s)')
	pl.title('t_sed_1_field')
	pl.savefig('../figures/mean/t_sed_1_field.png')
	pl.figure()
	pl.plot( x,t_ips_1_field )
	pl.xlabel('time (s)')
	pl.title('t_ips_1_field')
	pl.savefig('../figures/mean/t_ips_1_field.png')
	pl.figure()
	pl.plot(x,temp_field)
	pl.xlabel('time (s)')
	pl.title('temp_field')
	pl.savefig('../figures/mean/temp_field.png')
	pl.figure()
	pl.plot(x,salt_field)
	pl.xlabel('time (s)')
	pl.title('salt_field')
	pl.savefig('../figures/mean/salt_field.png')

	# Plot 10y
	pl.figure()
	pl.plot( x,t_cya_field_10y )
	pl.xlabel('time')
	pl.title('t_cya_field 10-year mean')
	pl.savefig('../figures/mean/t_cya_field_10y.png')
	pl.figure()
	pl.plot( x,t_lpp_field_10y )
	pl.xlabel('time (s)')
	pl.title('t_lpp_field 10-year mean')
	pl.savefig('../figures/mean/t_lpp_field_10y.png')
	pl.figure()
	pl.plot(x,t_spp_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_spp_field 10-year mean')
	pl.savefig('../figures/mean/t_spp_field_10y.png')
	pl.figure()
	pl.plot(x,t_nh4_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_nh4_field 10-year mean')
	pl.savefig('../figures/mean/t_nh4_field_10y.png')
	pl.figure()
	pl.plot(x,t_no3_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_no3_field 10-year mean')
	pl.savefig('../figures/mean/t_no3_field_10y.png')
	pl.figure()
	pl.plot(x,t_po4_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_po4_field 10-year mean')
	pl.savefig('../figures/mean/t_po4_field_10y.png')
	pl.figure()
	pl.plot(x,t_zoo_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_zoo_field 10-year mean')
	pl.savefig('../figures/mean/t_zoo_field_10y.png')
	pl.figure()
	pl.plot(x,t_ipw_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_ipw_field 10-year mean')
	pl.savefig('../figures/mean/t_ipw_field_10y.png')
	pl.figure()
	pl.plot(x, t_det_field_10y )
	pl.xlabel('time (s)')
	pl.title('t_det_field 10-year mean')
	pl.savefig('../figures/mean/t_det_field_10y.png')
	pl.figure()
	pl.plot( x,t_don_field_10y )
	pl.xlabel('time (s)')
	pl.title('t_don_field 10-year mean')
	pl.savefig('../figures/mean/t_don_field_10y.png')
	pl.figure()
	pl.plot( x,t_sed_1_field_10y )
	pl.xlabel('time (s)')
	pl.title('t_sed_1_field 10-year mean')
	pl.savefig('../figures/mean/t_sed_1_field_10y.png')
	pl.figure()
	pl.plot( x,t_ips_1_field_10y )
	pl.xlabel('time (s)')
	pl.title('t_ips_1_field 10-year mean')
	pl.savefig('../figures/mean/t_ips_1_field_10y.png')
	pl.figure()
	pl.plot(x,temp_field_10y)
	pl.xlabel('time (s)')
	pl.title('temp_field 10-year mean')
	pl.savefig('../figures/mean/temp_field_10y.png')
	pl.figure()
	pl.plot(x,salt_field_10y)
	pl.xlabel('time (s)')
	pl.title('salt_field 10-year mean')
	pl.savefig('../figures/mean/salt_field_10y.png')
	# Plot Running mean
	pl.figure()
	pl.plot( x,t_cya_field_run )
	pl.xlabel('time')
	pl.title('t_cya_field running mean')
	pl.savefig('../figures/mean/t_cya_field_run.png')
	pl.figure()
	pl.plot( x,t_lpp_field_run )
	pl.xlabel('time (s)')
	pl.title('t_lpp_field running mean')
	pl.savefig('../figures/mean/t_lpp_field_run.png')
	pl.figure()
	pl.plot(x,t_spp_field_run)
	pl.xlabel('time (s)')
	pl.title('t_spp_field running mean')
	pl.savefig('../figures/mean/t_spp_field_run.png')
	pl.figure()
	pl.plot(x,t_nh4_field_run)
	pl.xlabel('time (s)')
	pl.title('t_nh4_field running mean')
	pl.savefig('../figures/mean/t_nh4_field_run.png')
	pl.figure()
	pl.plot(x,t_no3_field_run)
	pl.xlabel('time (s)')
	pl.title('t_no3_field running mean')
	pl.savefig('../figures/mean/t_no3_field_run.png')
	pl.figure()
	pl.plot(x,t_po4_field_run)
	pl.xlabel('time (s)')
	pl.title('t_po4_field running mean')
	pl.savefig('../figures/mean/t_po4_field_run.png')
	pl.figure()
	pl.plot(x,t_zoo_field_run)
	pl.xlabel('time (s)')
	pl.title('t_zoo_field running mean')
	pl.savefig('../figures/mean/t_zoo_field_run.png')
	pl.figure()
	pl.plot(x,t_ipw_field_run)
	pl.xlabel('time (s)')
	pl.title('t_ipw_field running mean')
	pl.savefig('../figures/mean/t_ipw_field_run.png')
	pl.figure()
	pl.plot( x,t_det_field_run )
	pl.xlabel('time (s)')
	pl.title('t_det_field running mean')
	pl.savefig('../figures/mean/t_det_field_run.png')
	pl.figure()
	pl.plot( x,t_don_field_run )
	pl.xlabel('time (s)')
	pl.title('t_don_field running mean')
	pl.savefig('../figures/mean/t_don_field_run.png')
	pl.figure()
	pl.plot( x,t_sed_1_field_run )
	pl.xlabel('time (s)')
	pl.title('t_sed_1_field running mean')
	pl.savefig('../figures/mean/t_sed_1_field_run.png')
	pl.figure()
	pl.plot( x,t_ips_1_field_run )
	pl.xlabel('time (s)')
	pl.title('t_ips_1_field running mean')
	pl.savefig('../figures/mean/t_ips_1_field_run.png')
	pl.figure()
	pl.plot(x,temp_field_run)
	pl.xlabel('time (s)')
	pl.title('temp_field running mean')
	pl.savefig('../figures/mean/temp_field_run.png')
	pl.figure()
	pl.plot(x,salt_field_run)
	pl.xlabel('time (s)')
	pl.title('salt_field running mean')
	pl.savefig('../figures/mean/salt_field_run.png')
	print 'Figures saved in ../figures/mean'
