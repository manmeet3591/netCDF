from scipy.interpolate import interp1d
import sys, string
from matplotlib import rc
import numpy as np
import pylab as pl
import netCDF4
import time as t
import datetime
from dateutil.parser import parse
from pylab import load, meshgrid, title, arange, show
from netcdftime import utime
import scipy.io
import matplotlib as mpl
import argparse
from matplotlib.dates import MonthLocator, WeekdayLocator, DateFormatter
import datetime as dt


plot = False

t_cya_field =np.array([])
t_lpp_field =np.array([])
t_spp_field =np.array([])
t_nh4_field =np.array([])
t_no3_field =np.array([])
t_po4_field =np.array([])
t_zoo_field =np.array([])
t_ipw_field =np.array([])
t_det_field =np.array([])
t_don_field =np.array([])
t_sed_1_field =np.array([])
t_ips_1_field =np.array([])
temp_field =np.array([])
salt_field =np.array([])

for i in range (1851, 2010):
	year = str(i)
	nc_data = netCDF4.Dataset('/silos/boergel/BREC/files/auswertung' + year + '.nc')
	variable_list = []
	for i in nc_data.variables:
	    variable_list.append(nc_data.variables[str(i)])
	t_cya_field =np.append(t_cya_field , np.mean(variable_list[16][:]))
	t_lpp_field =np.append(t_lpp_field , np.mean(variable_list[17][:]))
	t_spp_field =np.append(t_spp_field , np.mean(variable_list[18][:]))
	t_nh4_field =np.append(t_nh4_field , np.mean(variable_list[19][:]))
	t_no3_field =np.append(t_no3_field , np.mean(variable_list[20][:]))
	t_po4_field =np.append(t_po4_field , np.mean(variable_list[21][:]))
	t_zoo_field =np.append(t_zoo_field , np.mean(variable_list[22][:]))
	t_ipw_field =np.append(t_ipw_field , np.mean(variable_list[23][:]))
	t_det_field =np.append(t_det_field , np.mean(variable_list[24][:]))
	t_don_field =np.append(t_don_field , np.mean(variable_list[25][:]))
	t_sed_1_field =np.append(t_sed_1_field , np.mean(variable_list[26][:]))
	t_ips_1_field =np.append(t_ips_1_field , np.mean(variable_list[27][:]))
	temp_field =np.append(temp_field , np.mean(variable_list[28][:]))
	salt_field =np.append(salt_field , np.mean(variable_list[29][:]))

## Calculate 10 year mean
t_cya_field_10y =np.ones([len(t_cya_field)/10+1])
t_lpp_field_10y =np.ones([len(t_cya_field)/10+1])
t_spp_field_10y =np.ones([len(t_cya_field)/10+1])
t_nh4_field_10y =np.ones([len(t_cya_field)/10+1])
t_no3_field_10y =np.ones([len(t_cya_field)/10+1])
t_po4_field_10y =np.ones([len(t_cya_field)/10+1])
t_zoo_field_10y =np.ones([len(t_cya_field)/10+1])
t_ipw_field_10y =np.ones([len(t_cya_field)/10+1])
t_det_field_10y =np.ones([len(t_cya_field)/10+1])
t_don_field_10y =np.ones([len(t_cya_field)/10+1])
t_sed_1_field_10y =np.ones([len(t_cya_field)/10+1])
t_ips_1_field_10y =np.ones([len(t_cya_field)/10+1])
temp_field_10y =np.ones([len(t_cya_field)/10+1])
salt_field_10y =np.ones([len(t_cya_field)/10+1])

for i in range(len(t_cya_field)/10+1):
	t_cya_field_10y[i] = np.mean(t_cya_field[0+i*10:9+i*10])
	t_lpp_field_10y[i] = np.mean(t_lpp_field[0+i*10:9+i*10])
	t_spp_field_10y[i] = np.mean(t_spp_field[0+i*10:9+i*10])
	t_nh4_field_10y[i] = np.mean(t_nh4_field[0+i*10:9+i*10])
	t_no3_field_10y[i] = np.mean(t_no3_field[0+i*10:9+i*10])
	t_po4_field_10y[i] = np.mean(t_po4_field[0+i*10:9+i*10])
	t_zoo_field_10y[i] = np.mean(t_zoo_field[0+i*10:9+i*10])
	t_ipw_field_10y[i] = np.mean(t_ipw_field[0+i*10:9+i*10])
	t_det_field_10y[i] = np.mean(t_det_field[0+i*10:9+i*10])
	t_don_field_10y[i] = np.mean(t_don_field[0+i*10:9+i*10])
	t_sed_1_field_10y[i] = np.mean(t_sed_1_field[0+i*10:9+i*10])
	t_ips_1_field_10y[i] = np.mean(t_ips_1_field[0+i*10:9+i*10])
	temp_field_10y[i] = np.mean(temp_field[0+i*10:9+i*10])
	salt_field_10y[i] = np.mean(salt_field[0+i*10:9+i*10])

## Calculate Running mean
t_cya_field_run =np.array([])
t_lpp_field_run =np.array([])
t_spp_field_run =np.array([])
t_nh4_field_run =np.array([])
t_no3_field_run =np.array([])
t_po4_field_run =np.array([])
t_zoo_field_run =np.array([])
t_ipw_field_run =np.array([])
t_det_field_run =np.array([])
t_don_field_run =np.array([])
t_sed_1_field_run =np.array([])
t_ips_1_field_run =np.array([])
temp_field_run =np.array([])
salt_field_run =np.array([])

for i in range(len(t_cya_field)):
	t_cya_field_run = np.append(t_cya_field_run, np.mean(t_cya_field[i:i+3]))
	t_lpp_field_run = np.append(t_lpp_field_run, np.mean(t_lpp_field[i:i+3]))
	t_spp_field_run = np.append(t_spp_field_run, np.mean(t_spp_field[i:i+3]))
	t_nh4_field_run = np.append(t_nh4_field_run, np.mean(t_nh4_field[i:i+3]))
	t_no3_field_run = np.append(t_no3_field_run, np.mean(t_no3_field[i:i+3]))
	t_po4_field_run = np.append(t_po4_field_run, np.mean(t_po4_field[i:i+3]))
	t_zoo_field_run = np.append(t_zoo_field_run, np.mean(t_zoo_field[i:i+3]))
	t_ipw_field_run = np.append(t_ipw_field_run, np.mean(t_ipw_field[i:i+3]))
	t_det_field_run = np.append(t_det_field_run, np.mean(t_det_field[i:i+3]))
	t_don_field_run = np.append(t_don_field_run, np.mean(t_don_field[i:i+3]))
	t_sed_1_field_run = np.append(t_sed_1_field_run, np.mean(t_sed_1_field[i:i+3]))
	t_ips_1_field_run = np.append(t_ips_1_field_run, np.mean(t_ips_1_field[i:i+3]))
	temp_field_run = np.append(temp_field_run, np.mean(temp_field[i:i+3]))
	salt_field_run = np.append(salt_field_run, np.mean(salt_field[i:i+3]))

x = np.arange((len(temp_field)))
fit = np.polyfit(x,temp_field,1)
fit_fn = np.poly1d(fit)

pl.plot(x, temp_field, '-b', x, fit_fn(x), '--k')
pl.show()



if plot == True:
	# Plot Field
	pl.figure()
	pl.plot( t_cya_field )
	pl.xlabel('time')
	pl.title('t_cya_field')
	pl.savefig('../figures/mean/t_cya_field.png')
	pl.figure()
	pl.plot( t_lpp_field )
	pl.xlabel('time (s)')
	pl.title('t_lpp_field')
	pl.savefig('../figures/mean/t_lpp_field.png')
	pl.figure()
	pl.plot(t_spp_field)
	pl.xlabel('time (s)')
	pl.title('t_spp_field')
	pl.savefig('../figures/mean/t_spp_field.png')
	pl.figure()
	pl.plot(t_nh4_field)
	pl.xlabel('time (s)')
	pl.title('t_nh4_field')
	pl.savefig('../figures/mean/t_nh4_field.png')
	pl.figure()
	pl.plot(t_no3_field)
	pl.xlabel('time (s)')
	pl.title('t_no3_field')
	pl.savefig('../figures/mean/t_no3_field.png')
	pl.figure()
	pl.plot(t_po4_field)
	pl.xlabel('time (s)')
	pl.title('t_po4_field')
	pl.savefig('../figures/mean/t_po4_field.png')
	pl.figure()
	pl.plot(t_zoo_field)
	pl.xlabel('time (s)')
	pl.title('t_zoo_field')
	pl.savefig('../figures/mean/t_zoo_field.png')
	pl.figure()
	pl.plot(t_ipw_field)
	pl.xlabel('time (s)')
	pl.title('t_ipw_field')
	pl.savefig('../figures/mean/t_ipw_field.png')
	pl.figure()
	pl.plot( t_det_field )
	pl.xlabel('time (s)')
	pl.title('t_det_field')
	pl.savefig('../figures/mean/t_det_field.png')
	pl.figure()
	pl.plot( t_don_field )
	pl.xlabel('time (s)')
	pl.title('t_don_field')
	pl.savefig('../figures/mean/t_don_field.png')
	pl.figure()
	pl.plot( t_sed_1_field )
	pl.xlabel('time (s)')
	pl.title('t_sed_1_field')
	pl.savefig('../figures/mean/t_sed_1_field.png')
	pl.figure()
	pl.plot( t_ips_1_field )
	pl.xlabel('time (s)')
	pl.title('t_ips_1_field')
	pl.savefig('../figures/mean/t_ips_1_field.png')
	pl.figure()
	pl.plot(temp_field)
	pl.xlabel('time (s)')
	pl.title('temp_field')
	pl.savefig('../figures/mean/temp_field.png')
	pl.figure()
	pl.plot(salt_field)
	pl.xlabel('time (s)')
	pl.title('salt_field')
	pl.savefig('../figures/mean/salt_field.png')

	# Plot 10y
	pl.figure()
	pl.plot( t_cya_field_10y )
	pl.xlabel('time')
	pl.title('t_cya_field_10y')
	pl.savefig('../figures/mean/t_cya_field_10y.png')
	pl.figure()
	pl.plot( t_lpp_field_10y )
	pl.xlabel('time (s)')
	pl.title('t_lpp_field_10y')
	pl.savefig('../figures/mean/t_lpp_field_10y.png')
	pl.figure()
	pl.plot(t_spp_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_spp_field_10y')
	pl.savefig('../figures/mean/t_spp_field_10y.png')
	pl.figure()
	pl.plot(t_nh4_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_nh4_field_10y')
	pl.savefig('../figures/mean/t_nh4_field_10y.png')
	pl.figure()
	pl.plot(t_no3_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_no3_field_10y')
	pl.savefig('../figures/mean/t_no3_field_10y.png')
	pl.figure()
	pl.plot(t_po4_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_po4_field_10y')
	pl.savefig('../figures/mean/t_po4_field_10y.png')
	pl.figure()
	pl.plot(t_zoo_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_zoo_field_10y')
	pl.savefig('../figures/mean/t_zoo_field_10y.png')
	pl.figure()
	pl.plot(t_ipw_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_ipw_field_10y')
	pl.savefig('../figures/mean/t_ipw_field_10y.png')
	pl.figure()
	pl.plot( t_det_field_10y )
	pl.xlabel('time (s)')
	pl.title('t_det_field_10y')
	pl.savefig('../figures/mean/t_det_field_10y.png')
	pl.figure()
	pl.plot( t_don_field_10y )
	pl.xlabel('time (s)')
	pl.title('t_don_field_10y')
	pl.savefig('../figures/mean/t_don_field_10y.png')
	pl.figure()
	pl.plot( t_sed_1_field_10y )
	pl.xlabel('time (s)')
	pl.title('t_sed_1_field_10y')
	pl.savefig('../figures/mean/t_sed_1_field_10y.png')
	pl.figure()
	pl.plot( t_ips_1_field_10y )
	pl.xlabel('time (s)')
	pl.title('t_ips_1_field_10y')
	pl.savefig('../figures/mean/t_ips_1_field_10y.png')
	pl.figure()
	pl.plot(temp_field_10y)
	pl.xlabel('time (s)')
	pl.title('temp_field_10y')
	pl.savefig('../figures/mean/temp_field_10y.png')
	pl.figure()
	pl.plot(salt_field_10y)
	pl.xlabel('time (s)')
	pl.title('salt_field_10y')
	pl.savefig('../figures/mean/salt_field_10y.png')
	pl.figure()
	pl.plot( t_cya_field_10y )
	pl.xlabel('time')
	pl.title('t_cya_field_10y')
	pl.savefig('../figures/mean/t_cya_field_10y.png')
	pl.figure()
	pl.plot( t_lpp_field_10y )
	pl.xlabel('time (s)')
	pl.title('t_lpp_field_10y')
	pl.savefig('../figures/mean/t_lpp_field_10y.png')
	pl.figure()
	pl.plot(t_spp_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_spp_field_10y')
	pl.savefig('../figures/mean/t_spp_field_10y.png')
	pl.figure()
	pl.plot(t_nh4_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_nh4_field_10y')
	pl.savefig('../figures/mean/t_nh4_field_10y.png')
	pl.figure()
	pl.plot(t_no3_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_no3_field_10y')
	pl.savefig('../figures/mean/t_no3_field_10y.png')
	pl.figure()
	pl.plot(t_po4_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_po4_field_10y')
	pl.savefig('../figures/mean/t_po4_field_10y.png')
	pl.figure()
	pl.plot(t_zoo_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_zoo_field_10y')
	pl.savefig('../figures/mean/t_zoo_field_10y.png')
	pl.figure()
	pl.plot(t_ipw_field_10y)
	pl.xlabel('time (s)')
	pl.title('t_ipw_field_10y')
	pl.savefig('../figures/mean/t_ipw_field_10y.png')
	pl.figure()
	pl.plot( t_det_field_10y )
	pl.xlabel('time (s)')
	pl.title('t_det_field_10y')
	pl.savefig('../figures/mean/t_det_field_10y.png')
	pl.figure()
	pl.plot( t_don_field_10y )
	pl.xlabel('time (s)')
	pl.title('t_don_field_10y')
	pl.savefig('../figures/mean/t_don_field_10y.png')
	pl.figure()
	pl.plot( t_sed_1_field_10y )
	pl.xlabel('time (s)')
	pl.title('t_sed_1_field_10y')
	pl.savefig('../figures/mean/t_sed_1_field_10y.png')
	pl.figure()
	pl.plot( t_ips_1_field_10y )
	pl.xlabel('time (s)')
	pl.title('t_ips_1_field_10y')
	pl.savefig('../figures/mean/t_ips_1_field_10y.png')
	pl.figure()
	pl.plot(temp_field_10y)
	pl.xlabel('time (s)')
	pl.title('temp_field_10y')
	pl.savefig('../figures/mean/temp_field_10y.png')
	pl.figure()
	pl.plot(salt_field_10y)
	pl.xlabel('time (s)')
	pl.title('salt_field_10y')
	pl.savefig('../figures/mean/salt_field_10y.png')
	# Plot Running mean
	pl.figure()
	pl.plot( t_cya_field_run )
	pl.xlabel('time')
	pl.title('t_cya_field_run')
	pl.savefig('../figures/mean/t_cya_field_run.png')
	pl.figure()
	pl.plot( t_lpp_field_run )
	pl.xlabel('time (s)')
	pl.title('t_lpp_field_run')
	pl.savefig('../figures/mean/t_lpp_field_run.png')
	pl.figure()
	pl.plot(t_spp_field_run)
	pl.xlabel('time (s)')
	pl.title('t_spp_field_run')
	pl.savefig('../figures/mean/t_spp_field_run.png')
	pl.figure()
	pl.plot(t_nh4_field_run)
	pl.xlabel('time (s)')
	pl.title('t_nh4_field_run')
	pl.savefig('../figures/mean/t_nh4_field_run.png')
	pl.figure()
	pl.plot(t_no3_field_run)
	pl.xlabel('time (s)')
	pl.title('t_no3_field_run')
	pl.savefig('../figures/mean/t_no3_field_run.png')
	pl.figure()
	pl.plot(t_po4_field_run)
	pl.xlabel('time (s)')
	pl.title('t_po4_field_run')
	pl.savefig('../figures/mean/t_po4_field_run.png')
	pl.figure()
	pl.plot(t_zoo_field_run)
	pl.xlabel('time (s)')
	pl.title('t_zoo_field_run')
	pl.savefig('../figures/mean/t_zoo_field_run.png')
	pl.figure()
	pl.plot(t_ipw_field_run)
	pl.xlabel('time (s)')
	pl.title('t_ipw_field_run')
	pl.savefig('../figures/mean/t_ipw_field_run.png')
	pl.figure()
	pl.plot( t_det_field_run )
	pl.xlabel('time (s)')
	pl.title('t_det_field_run')
	pl.savefig('../figures/mean/t_det_field_run.png')
	pl.figure()
	pl.plot( t_don_field_run )
	pl.xlabel('time (s)')
	pl.title('t_don_field_run')
	pl.savefig('../figures/mean/t_don_field_run.png')
	pl.figure()
	pl.plot( t_sed_1_field_run )
	pl.xlabel('time (s)')
	pl.title('t_sed_1_field_run')
	pl.savefig('../figures/mean/t_sed_1_field_run.png')
	pl.figure()
	pl.plot( t_ips_1_field_run )
	pl.xlabel('time (s)')
	pl.title('t_ips_1_field_run')
	pl.savefig('../figures/mean/t_ips_1_field_run.png')
	pl.figure()
	pl.plot(temp_field_run)
	pl.xlabel('time (s)')
	pl.title('temp_field_run')
	pl.savefig('../figures/mean/temp_field_run.png')
	pl.figure()
	pl.plot(salt_field_run)
	pl.xlabel('time (s)')
	pl.title('salt_field_run')
	pl.savefig('../figures/mean/salt_field_run.png')
